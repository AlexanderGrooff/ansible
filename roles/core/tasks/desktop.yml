---
- name: Define desktop packages
  set_fact:
    desktop_packages: [
      autorandr,
      flameshot,
      fonts-font-awesome,
      pavucontrol,
      py3status,
      rofi,
      sakura,
    ]

- name: Install generic desktop packages for Debian
  apt:
    name: "{{ desktop_packages }}"
  become: true
  when: ansible_os_family == "Debian"

- name: Install generic desktop packages for Arch
  kewlfft.aur.aur:
    name: "{{ desktop_packages }}"
  become: true
  when: ansible_distribution == "Archlinux"

- name: Manage i3wm
  block:
    - name: Install desktop packages for Arch
      kewlfft.aur.aur:
        name: [
          i3-wm,
          i3lock,
        ]
        state: present
      become: true
      when: ansible_distribution == "Archlinux"

    - name: Install desktop packages for Debian
      apt:
        name: [
          i3-wm,
          i3lock,
        ]
        state: latest
      become: true
      when: ansible_os_family == "Debian"
  when: desktop.wm == "i3"

- name: Manage Sway
  block:
    - name: Install sway
      apt:
        name: [
          grimshot,  # Screenshot tool
          sway,
          swaylock,
          wdisplays,
          weston,  # Compositor
        ]
        state: latest
      become: true
      when: ansible_os_family == "Debian"
  when: desktop.wm == "sway"

- name: Create user service directory
  file:
    path: /home/alex/.config/systemd/user/
    state: directory
    recurse: yes
    owner: alex
    group: alex

- name: Place user service files
  template:
    src: config/systemd/user/hnproxy.service
    dest: /home/alex/.config/systemd/user/hnproxy.service
    owner: alex
    group: alex

- name: Start hnproxy service
  systemd:
    name: hnproxy
    state: started
    enabled: yes
    scope: user
    daemon_reload: yes
